name: Legacy ITC Tests

on:
  pull_request:
    paths:
      - 'itc/service/ocslib/**'
      - 'itc/legacy-tests/**'
  schedule:
    - cron: '0 2 * * *'  # Daily at 2 AM UTC
  workflow_dispatch:

jobs:
  legacy-tests:
    name: ITC Legacy Tests
    if: github.event_name == 'schedule' || github.event_name == 'workflow_dispatch' || github.event_name == 'pull_request'
    runs-on: ubuntu-latest
    strategy:
      matrix:
        java: ['17']
        scala: ['3.7.3']
    steps:
      - name: Checkout code
        uses: nschloe/action-cached-lfs-checkout@v1

      - name: Setup sbt
        uses: sbt/setup-sbt@v1

      - name: Setup Java (temurin@17)
        id: setup-java-temurin-17
        if: matrix.java == 'temurin@17'
        uses: actions/setup-java@v4
        with:
          distribution: temurin
          java-version: 17
          cache: sbt

      - name: Run Legacy ITC Tests
        env:
          RUN_LEGACY_TESTS: true
        run: sbt -v -J-Xmx6g itcLegacyTests/test
